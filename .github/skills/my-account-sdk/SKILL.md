# MyAccount JS SDK - Agent Guidelines

**Version 1.0.0**
Auth0 Engineering
February 2026

> **Note:**
> This document is for AI agents and LLMs to follow when maintaining,
> contributing to, or working with the @auth0/myaccount-js SDK.
> It contains critical information about generated code, testing patterns,
> and development workflows.

---

## Abstract

The @auth0/myaccount-js SDK is a TypeScript client that enables end-users to manage their own Auth0 profile, authentication methods (MFA), and connected accounts. **Most of the codebase is auto-generated by Fern** from API specifications. This guide helps AI agents understand the codebase structure, identify what can be modified, and follow proper contribution workflows.

---

## Table of Contents

1. [Critical Information](#1-critical-information) - **READ FIRST**
2. [Project Overview](#2-project-overview)
3. [Architecture](#3-architecture)
4. [Development Workflow](#4-development-workflow)
5. [Testing Guidelines](#5-testing-guidelines)
6. [Code Patterns](#6-code-patterns)
7. [Common Tasks](#7-common-tasks)
8. [API Reference](#8-api-reference)
9. [Integration with auth0-ui-components](#9-integration-with-auth0-ui-components) - **CONSUMER REFERENCE**

---

## 1. Critical Information

**Impact: CRITICAL - Read before making any changes**

### 1.1 Generated Code Warning

**MOST FILES IN THIS SDK ARE AUTO-GENERATED BY FERN.**

The following directories contain generated code that **WILL BE OVERWRITTEN**:

- `src/api/` - API client classes and types
- `src/api/resources/` - Resource-specific endpoints
- `src/api/types/` - TypeScript type definitions
- `src/api/errors/` - Error classes
- `src/core/` - Core utilities
- `src/errors/` - Error handling
- `src/wrappers/` - API response wrappers

**Do NOT directly modify these files** unless the changes are tracked in `.fernignore`.

### 1.2 Safe to Modify

These files/directories CAN be safely modified:

- `README.md` - Documentation
- `CONTRIBUTING.md` - Contribution guidelines
- `tests/` - Test files
- `example.ts` - Usage examples
- `.github/` - CI/CD workflows
- Configuration files (`tsconfig.*.json`, `eslint.config.mjs`, etc.)
- Files listed in `.fernignore`

### 1.3 Customization Approach

To add custom code that persists across regenerations:

1. Add file patterns to `.fernignore`
2. Create custom files in those locations
3. Files in `.fernignore` will NOT be overwritten during SDK regeneration

---

## 2. Project Overview

### 2.1 Purpose

The SDK provides a TypeScript client for Auth0's MyAccount API, enabling end-users to:

- Manage their user profile
- Enroll/unenroll MFA authentication methods (TOTP, SMS, Email, Push, WebAuthn)
- View and manage connected accounts (social connections)
- Manage sessions
- Access recovery codes

### 2.2 Package Information

```json
{
  "name": "@auth0/myaccount-js",
  "main": "./dist/cjs/index.js",
  "module": "./dist/esm/index.mjs",
  "types": "./dist/cjs/index.d.ts"
}
```

### 2.3 Entry Points

| Entry Point | Description |
|-------------|-------------|
| `@auth0/myaccount-js` | Main client for browser/Node.js |

### 2.4 Runtime Support

- Node.js 18+
- Vercel Edge Functions
- Cloudflare Workers
- Deno v1.25+
- Bun 1.0+
- React Native

---

## 3. Architecture

### 3.1 Directory Structure

```
src/
├── Client.ts           # Main client class
├── BaseClient.ts       # Base client with HTTP utilities
├── index.ts            # Public exports
├── exports.ts          # Re-exports for convenience
├── environments.ts     # Environment configuration
├── version.ts          # SDK version
├── api/
│   ├── index.ts        # API exports
│   ├── errors/         # API error classes
│   ├── requests/       # Request type definitions
│   ├── resources/      # Resource clients (factors, authMethods, etc.)
│   └── types/          # Type definitions
├── core/               # Core HTTP/serialization utilities
├── errors/             # Error handling
├── utils/              # Utility functions
└── wrappers/           # API response wrappers
```

### 3.2 Client Architecture

```typescript
// Main client initialization
const client = new MyAccountClient({
    domain: "tenant.region.auth0.com",
    token: "ACCESS_TOKEN",  // or token supplier function
});

// Resource access pattern
client.factors.list();
client.authenticationMethods.list();
client.authenticationMethods.create({ type: "totp" });
client.authenticationMethods.verify(methodId, { ... });
client.authenticationMethods.delete(methodId);
client.connectedAccounts.list({ connection: "google-oauth2" });
```

### 3.3 Authentication Patterns

**Static Token:**
```typescript
const client = new MyAccountClient({
    domain: "tenant.auth0.com",
    token: "static_access_token",
});
```

**Token Supplier (Recommended):**
```typescript
const client = new MyAccountClient({
    domain: "tenant.auth0.com",
    token: async ({ scope }) => {
        return await getAccessToken({ scope });
    },
});
```

**Custom Fetcher:**
```typescript
const client = new MyAccountClient({
    domain: "tenant.auth0.com",
    fetcher: async (url, init, authParams) => {
        const token = await getAccessToken({ scope: authParams?.scope });
        return fetch(url, {
            ...init,
            headers: { ...init?.headers, Authorization: `Bearer ${token}` },
        });
    },
});
```

---

## 4. Development Workflow

### 4.1 Prerequisites

- Node.js 20 or higher
- pnpm package manager

### 4.2 Common Commands

| Command | Description |
|---------|-------------|
| `pnpm install` | Install dependencies |
| `pnpm build` | Build CJS and ESM outputs |
| `pnpm test` | Run all tests |
| `pnpm test:unit` | Run unit tests only |
| `pnpm test:wire` | Run wire/integration tests |
| `pnpm lint` | Check code style |
| `pnpm lint:fix` | Fix linting issues |
| `pnpm format` | Format code with Prettier |
| `pnpm format:check` | Check formatting |
| `pnpm check:fix` | Run all checks and auto-fix |
| `pnpm docs` | Generate TypeDoc documentation |

### 4.3 Build Process

The SDK builds to both CommonJS and ESM formats:

```bash
pnpm build:cjs  # TypeScript -> dist/cjs/
pnpm build:esm  # TypeScript -> dist/esm/ (with .mjs extension)
```

### 4.4 Pre-commit Hooks

The project uses Husky with lint-staged:

- TypeScript files: ESLint + Prettier
- JSON/CSS/MD files: Prettier

---

## 5. Testing Guidelines

### 5.1 Test Structure

```
tests/
├── custom.test.ts      # Custom test cases
├── mock-server/        # Mock server setup for wire tests
├── unit/               # Unit tests
├── wire/               # Integration/wire tests
└── tsconfig.json       # Test-specific TypeScript config
```

### 5.2 Test Framework

The SDK uses **Vitest** with **MSW** (Mock Service Worker) for API mocking:

```typescript
import { describe, it, expect } from 'vitest';

describe('MyAccountClient', () => {
    it('should list authentication methods', async () => {
        const client = new MyAccountClient({
            domain: 'test.auth0.com',
            token: 'test_token',
        });

        const methods = await client.authenticationMethods.list();
        expect(methods.authentication_methods).toBeDefined();
    });
});
```

### 5.3 Running Tests

```bash
# All tests
pnpm test

# Unit tests only (fast, no network)
pnpm test:unit

# Wire tests (with mocked HTTP)
pnpm test:wire

# Watch mode
pnpm test -- --watch
```

---

## 6. Code Patterns

### 6.1 Error Handling

```typescript
import { MyAccountClient, MyAccountError } from "@auth0/myaccount-js";

try {
    await client.authenticationMethods.create({ type: "totp" });
} catch (err) {
    if (err instanceof MyAccountError) {
        console.log(err.statusCode);  // HTTP status code
        console.log(err.message);     // Error message
        console.log(err.body);        // Response body
        console.log(err.rawResponse); // Raw fetch Response
    }
}
```

### 6.2 Pagination

```typescript
let page = await client.connectedAccounts.list({
    connection: "google-oauth2",
    take: 10,
});

// Process first page
console.log(page.data);

// Iterate through pages
while (page.hasNextPage()) {
    page = await page.getNextPage();
    console.log(page.data);
}
```

### 6.3 Request Options

All methods accept optional request options:

```typescript
await client.authenticationMethods.create(
    { type: "totp" },
    {
        headers: { "X-Custom-Header": "value" },
        queryParams: { customParam: "value" },
        maxRetries: 3,
        timeoutInSeconds: 30,
        abortSignal: controller.signal,
    }
);
```

### 6.4 Raw Response Access

```typescript
const { data, rawResponse } = await client.authenticationMethods
    .create({ type: "totp" })
    .withRawResponse();

console.log(rawResponse.headers.get("X-RateLimit-Remaining"));
```

### 6.5 Retry Behavior

The SDK automatically retries on:
- 408 (Timeout)
- 429 (Rate Limited)
- 5xx (Server Errors)

Default: 2 retries with exponential backoff.

---

## 7. Common Tasks

### 7.1 Adding Custom Functionality

1. Add file pattern to `.fernignore`:
   ```
   src/custom/
   ```

2. Create custom module:
   ```typescript
   // src/custom/helpers.ts
   export function customHelper() {
       // Your custom code
   }
   ```

3. Export from index if needed (add to `.fernignore` first)

### 7.2 Updating Documentation

Safe to modify:
- `README.md` - Main documentation
- `reference.md` - API reference (may be generated)
- `CONTRIBUTING.md` - Contribution guide

### 7.3 Adding Tests

Create test files in `tests/unit/` or `tests/wire/`:

```typescript
// tests/unit/my-feature.test.ts
import { describe, it, expect } from 'vitest';

describe('My Feature', () => {
    it('should work correctly', () => {
        // Test implementation
    });
});
```

### 7.4 Fixing Generated Code Issues

If you find bugs in generated code:

1. **Do NOT fix directly** - changes will be lost
2. Open an issue describing the problem
3. For urgent fixes, add to `.fernignore` and create a patched version
4. Long-term: contribute to the Fern TypeScript generator

---

## 8. API Reference

### 8.1 Main Classes

| Class | Description |
|-------|-------------|
| `MyAccountClient` | Main client for API access |
| `MyAccountError` | Base error class |

### 8.2 Namespaces

| Namespace | Description |
|-----------|-------------|
| `MyAccount` | Type namespace for all request/response types |

### 8.3 Resource Endpoints

```typescript
client.factors                  // Available MFA factors
client.authenticationMethods    // Enrolled authentication methods (MFA)
client.connectedAccounts        // Social/external connections
client.sessions                 // User sessions
```

### 8.4 MFA Authentication Methods Types

| Type | Description |
|------|-------------|
| `totp` | Time-based One-Time Password (Authenticator apps) |
| `phone` | SMS-based verification |
| `email` | Email-based verification |
| `push-notification` | Push notification (Auth0 Guardian) |
| `webauthn-roaming` | Security keys (FIDO2) |
| `webauthn-platform` | Platform authenticators (Touch ID, Face ID) |
| `recovery-code` | Backup recovery codes |

---

## 9. Integration with auth0-ui-components

**Impact: HIGH - Understanding the consumption pattern**

The `@auth0/myaccount-js` SDK is consumed by the `auth0-ui-components` monorepo to provide pre-built React components for user account and MFA management.

### 9.1 Architecture Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                    auth0-ui-components                          │
├─────────────────────────────────────────────────────────────────┤
│  packages/react/                                                │
│  ├── components/auth0/my-account/       ← UI Components         │
│  │   ├── user-mfa-management.tsx                                │
│  │   └── shared/mfa/                    ← MFA Sub-components    │
│  │       ├── factors-list.tsx                                   │
│  │       ├── user-mfa-setup-form.tsx                            │
│  │       ├── otp-verification-form.tsx                          │
│  │       └── delete-factor-confirmation.tsx                     │
│  │                                                              │
│  └── hooks/my-account/                  ← React Hooks           │
│      └── use-mfa.ts                                             │
├─────────────────────────────────────────────────────────────────┤
│  packages/core/                                                 │
│  ├── auth/core-client.ts                ← Client Factory        │
│  └── services/my-account/                                       │
│      ├── my-account-api-service.ts      ← SDK Initialization    │
│      └── mfa/                           ← MFA Utilities         │
│          ├── mfa-types.ts               ← Type definitions      │
│          ├── mfa-mappers.ts             ← SDK → UI mapping      │
│          └── mfa-utils.ts               ← Helper functions      │
├─────────────────────────────────────────────────────────────────┤
│                    @auth0/myaccount-js                          │
│                    (External SDK Dependency)                    │
└─────────────────────────────────────────────────────────────────┘
```

### 9.2 SDK Initialization Pattern

The SDK is initialized in `packages/core/src/services/my-account/my-account-api-service.ts`:

```typescript
import { MyAccountClient } from '@auth0/myaccount-js';

export function initializeMyAccountClient(
  auth: AuthDetails,
  tokenManagerService: ReturnType<typeof createTokenManager>,
): { client: MyAccountClient; setLatestScopes: (scopes: string) => void } {
  let latestScopes = '';

  // Proxy mode (server-side token handling via RWA)
  if (auth.authProxyUrl) {
    return {
      client: new MyAccountClient({
        domain: '',
        baseUrl: `${auth.authProxyUrl}/me`,
        fetcher: async (url, init) => {
          return fetch(url, {
            ...init,
            headers: { ...init?.headers, 'auth0-scope': latestScopes },
          });
        },
      }),
      setLatestScopes: (scopes) => { latestScopes = scopes; },
    };
  }

  // Direct mode (client-side token handling via SPA)
  return {
    client: new MyAccountClient({
      domain: auth.domain,
      fetcher: async (url, init) => {
        const token = await tokenManagerService.getToken(latestScopes, 'me');
        return fetch(url, {
          ...init,
          headers: { ...init?.headers, Authorization: `Bearer ${token}` },
        });
      },
    }),
    setLatestScopes: (scopes) => { latestScopes = scopes; },
  };
}
```

### 9.3 Hook Consumption Pattern

The `useMFA` hook in `packages/react/src/hooks/my-account/use-mfa.ts` wraps SDK calls:

```typescript
import { MFAMappers } from '@auth0/universal-components-core';

export function useMFA(): UseMFAResult {
  const { coreClient } = useCoreClient();

  const fetchFactors = useCallback(async (onlyActive = false) => {
    const client = coreClient.getMyAccountApiClient();

    // Parallel fetch of available factors and enrolled methods
    const [availableFactorsResponse, enrolledFactorsResponse] = await Promise.all([
      client.factors.list(),
      client.authenticationMethods.list(),
    ]);

    // Transform SDK response to UI-friendly format
    return MFAMappers.fromAPI(availableFactorsResponse, enrolledFactorsResponse, onlyActive);
  }, [coreClient]);

  const enrollMfa = useCallback((factorName: MFAType, options: EnrollOptions = {}) => {
    const client = coreClient.getMyAccountApiClient();
    const params = MFAMappers.buildEnrollParams(factorName, options);
    return client.authenticationMethods.create(params);
  }, [coreClient]);

  const deleteMfa = useCallback((authenticatorId: string) => {
    return coreClient.getMyAccountApiClient().authenticationMethods.delete(authenticatorId);
  }, [coreClient]);

  const confirmEnrollment = useCallback((
    factorType: MFAType,
    authSession: string,
    authenticationMethodId: string,
    options: ConfirmEnrollmentOptions,
  ) => {
    const client = coreClient.getMyAccountApiClient();
    const params = MFAMappers.buildConfirmEnrollmentParams(factorType, authSession, options);
    return client.authenticationMethods.verify(authenticationMethodId, params);
  }, [coreClient]);

  return { fetchFactors, enrollMfa, deleteMfa, confirmEnrollment };
}
```

### 9.4 Component Consumption Pattern

The `UserMFAMgmt` component wraps the hook with an HOC for scope management:

```typescript
// user-mfa-management.tsx
import { withMyAccountService } from '@/hoc/with-services';
import { useMFA } from '@/hooks/my-account/use-mfa';

function UserMFAMgmtComponent(props: UserMFAMgmtProps) {
  const { fetchFactors, enrollMfa, deleteMfa, confirmEnrollment } = useMFA();

  const loadFactors = useCallback(async () => {
    const factors = await fetchFactors(showActiveOnly);
    setFactorsByType(factors);
  }, [fetchFactors, showActiveOnly]);

  const handleEnroll = async (factorType: MFAType) => {
    const response = await enrollMfa(factorType, options);
    // Handle enrollment flow (OTP verification, QR code, etc.)
  };

  const handleDelete = async (factorId: string) => {
    await deleteMfa(factorId);
    await loadFactors();
  };

  return (
    <Card>
      {visibleFactorTypes.map((factorType) => (
        <FactorsList
          factors={factorsByType[factorType]}
          onEnroll={() => handleEnroll(factorType)}
          onDelete={handleDelete}
        />
      ))}
    </Card>
  );
}

// HOC ensures required scopes are requested before rendering
export const UserMFAMgmt = withMyAccountService(
  UserMFAMgmtComponent,
  USER_MFA_SCOPES,  // e.g., 'read:authenticators delete:authenticators'
);
```

### 9.5 Key Files in auth0-ui-components

| File | Purpose |
|------|---------|
| `packages/core/src/services/my-account/my-account-api-service.ts` | SDK initialization |
| `packages/core/src/services/my-account/mfa/mfa-types.ts` | MFA type definitions using SDK types |
| `packages/core/src/services/my-account/mfa/mfa-mappers.ts` | SDK → UI data transformation |
| `packages/core/src/auth/core-client.ts` | Client factory with token management |
| `packages/react/src/hooks/my-account/use-mfa.ts` | React hook wrapping SDK |
| `packages/react/src/components/auth0/my-account/user-mfa-management.tsx` | Main MFA component |

### 9.6 SDK API Endpoints Used

| Hook/Function | SDK Methods Called |
|---------------|-------------------|
| `fetchFactors` | `factors.list()`, `authenticationMethods.list()` |
| `enrollMfa` | `authenticationMethods.create()` |
| `confirmEnrollment` | `authenticationMethods.verify()` |
| `deleteMfa` | `authenticationMethods.delete()` |

### 9.7 Type Re-exports from SDK

The core package re-exports SDK types for use in components:

```typescript
// packages/core/src/services/my-account/mfa/mfa-types.ts
import type { MyAccount } from '@auth0/myaccount-js';

export type ListFactorsResponseContent = MyAccount.ListFactorsResponseContent;
export type ListAuthenticationMethodsResponseContent = MyAccount.ListAuthenticationMethodsResponseContent;
export type CreateAuthenticationMethodRequestContent = MyAccount.CreateAuthenticationMethodRequestContent;
export type CreateAuthenticationMethodResponseContent = MyAccount.CreateAuthenticationMethodResponseContent;
export type VerifyAuthenticationMethodRequestContent = MyAccount.VerifyAuthenticationMethodRequestContent;
export type VerifyAuthenticationMethodResponseContent = MyAccount.VerifyAuthenticationMethodResponseContent;
```

### 9.8 Token & Scope Management

The integration uses dynamic scope injection:

```typescript
// Before rendering a component, ensureScopes() is called
await coreClient.ensureScopes(
  'read:authenticators delete:authenticators',  // Required scopes
  'me'                                           // Audience path
);

// This updates latestScopes in the SDK client
// The custom fetcher then includes the token with these scopes
```

### 9.9 Error Handling in Components

```typescript
import { MyAccountError } from '@auth0/myaccount-js';

const handleEnrollError = useCallback((error: Error, stage: 'enroll' | 'confirm') => {
  if (error instanceof MyAccountError) {
    // Handle API errors (4xx, 5xx)
    toast.error(`${stage === 'enroll' ? 'Enrollment' : 'Confirmation'} failed: ${error.message}`);
  }
  onErrorAction?.(error, stage);
}, [onErrorAction]);
```

### 9.10 MFA Enrollment Flow

```
┌──────────────────────────────────────────────────────────────────┐
│                    MFA Enrollment Flow                           │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. User clicks "Add" button                                     │
│     └─► useMFA.enrollMfa(factorType, options)                    │
│         └─► client.authenticationMethods.create({ type: ... })   │
│                                                                  │
│  2. SDK returns enrollment challenge                             │
│     └─► { authentication_method_id, auth_session, ... }          │
│                                                                  │
│  3. User completes challenge (OTP, QR scan, WebAuthn, etc.)      │
│     └─► useMFA.confirmEnrollment(factorType, authSession, id)    │
│         └─► client.authenticationMethods.verify(id, { ... })     │
│                                                                  │
│  4. SDK returns confirmation                                     │
│     └─► Factor is now enrolled and active                        │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

---

## References

1. [Auth0 Documentation](https://auth0.com/docs)
2. [SDK Repository](https://github.com/auth0/myaccount-js)
3. [API Reference](https://github.com/auth0/myaccount-js/blob/main/reference.md)
4. [Fern Documentation](https://buildwithfern.com)
5. [Fern Custom Code Guide](https://buildwithfern.com/learn/sdks/overview/custom-code)
6. [Auth0 MFA Documentation](https://auth0.com/docs/secure/multi-factor-authentication)
